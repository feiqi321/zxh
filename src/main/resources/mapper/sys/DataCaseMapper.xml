<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xyz.zaijushou.zhx.sys.dao.DataCaseMapper">

    <!--插入数据信息-->
    <insert id="saveArchive" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into data_case
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="batchNo != null">batch_no,</if>
            <if test="money != null">money,</if>
            <if test="balance != null">balance,</if>
            <if test="rate != null">rate,</if>
            <if test="remark != null">remark,</if>
            <if test="realReturnTime != null">real_return_time,</if>
            <if test="status != null">status,</if>
            delete_flag,
            create_time,
        </trim>
        values
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="batchNo != null">#{batchNo},</if>
            <if test="money != null">#{money},</if>
            <if test="balance != null">#{balance},</if>
            <if test="rate != null">#{rate},</if>
            <if test="remark != null">#{remark},</if>
            <if test="realReturnTime != null">#{real_return_time},</if>
            <if test="status != null">#{status},</if>
            0,
            now(),
        </trim>
    </insert>

    <update id="updateArchive" parameterType="xyz.zaijushou.zhx.sys.entity.DataArchiveEntity">
        update data_case
        set
        <trim suffixOverrides=",">
            <if test="money != null">money = #{money},</if>
            <if test="balance != null">balance = #{balance},</if>
            <if test="status != null">status = #{status},</if>
        </trim>
        where
        id = #{id}
    </update>

    <!--通过Id删除数据信息-->
    <delete id="deleteById" parameterType="java.lang.Integer">
        update data_case set delete_flag =1
        where id = #{id}
    </delete>

    <select id="pageDataCase" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
        id,money,balance,remark,status,create_time as createTime
        from data_case
        <where>
            <trim suffixOverrides=",">
                <if test="remark != null and remark!=''">
                    remark like CONCAT('%',#{remark},'%')
                </if>
            </trim>
        </where>
    </select>

    <!--数据模块-管理列表查询-->
    <select id="pageCaseList" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select da.id, da.batch_no as batchNo,da.client,da.collect_area as collectArea,da.dept,da.odv,da.status,da.area,da.expect_time as expectTime,
        da.collect_status as collectStatus , da.collect_date as collectDate,  da.account_age as accountAge ,da.seq_no as seqNo,da.case_date as caseDate,da.collect_hand as collectHand,
        da.real_repay_date as realRepayDate ,da.name as name ,da.card_no as cardNo,da.ident_no as identNo,DATE_FORMAT(da.distribute_time,'%Y-%m-%d') as distributeTime,
        da.money as money,da.balance as balance,da.over_days as overDays,da.pro_repay_date as proPepayDate,da.distribute_history as distributeHistory,
        da.bank_amt as bankAmt,da.en_repay_amt as enRepayAmt,da.pro_repay_amt as proRepayAmt,da.comment,da.area,da.pro_repay_amt as proRepayAmt
        from data_case da LEFT JOIN data_collection dc on da.id = dc.case_id
        <where>
            1 = 1
            <trim suffixOverrides=",">
                <if test="id != null and id!=''">
                    and da.id = #{id}
                </if>
                <if test="cardNo != null and cardNo!=''">
                    and da.card_no = #{cardNo}
                </if>
                <if test="clientFlag != null and clientFlag!=''">
                    and da.client in
                    <foreach item="item" index="index" collection="clients" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="batchNo != null and batchNo!=''">
                    and da.batch_no = #{batchNo}
                </if>
                <if test="odv != null and odv!=''">
                    and da.odv = #{odv}
                </if>
                <if test="dept != null and dept!=''">
                    and da.dept = #{dept}
                </if>

                <if test="accountAge != null and accountAge!=''">
                    and da.account_age = #{accountAge}
                </if>
                <if test="seqNo != null and seqNo!=''">
                    and da.seq_no = #{seqNo}
                </if>
                <if test="collectArea != null and collectArea!=''">
                    and da.collect_area = #{collectArea}
                </if>
                <if test="overDays != null and overDays!=''">
                    and da.overDays = #{overDays}
                </if>
                <if test="area != null and area!=''">
                    and da.area = #{area}
                </if>
                <if test="license != null and license!=''">
                    and da.license = #{license}
                </if>
                <if test="expectStartTime != null and expectStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(da.expect_time, '%Y-%m-%d')>=  DATE_FORMAT(#{expectStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="expectEndTime != null and expectEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(da.expect_time, '%Y-%m-%d')<=  DATE_FORMAT(#{expectEndTime}, '%Y-%m-%d')   ]]>
                </if>

                <if test="collectHand != null and collectHand!=''">
                    and da.collect_hand = #{collectHand}
                </if>
                <if test="distributeStatus != null and distributeStatus!=''">
                    and da.distribute_status = #{distributeStatus}
                </if>
                <if test="identNo != null and identNo!=''">
                    and da.identNo = #{identNo}
                </if>
                <if test="vin != null and vin!=''">
                    and da.vin = #{vin}
                </if>
                <if test="name != null and name!=''">
                    and da.name = #{name}
                </if>
                <if test="status != null and status!=''">
                    and da.status = #{status}
                </if>
                <if test="bank != null and bank!=''">
                    and da.bank = #{bank}
                </if>
                <if test="collectStartDate != null and collectStartDate!=''">
                    <![CDATA[   and DATE_FORMAT(da.collect_date, '%Y-%m-%d')>=  DATE_FORMAT(#{collectStartDate}, '%Y-%m-%d')   ]]>
                </if>
                <if test="collectEndDate != null and collectEndDate!=''" >
                    <![CDATA[   and DATE_FORMAT(da.collect_date, '%Y-%m-%d')>=  DATE_FORMAT(#{collectEndDate}, '%Y-%m-%d')   ]]>
                </if>
                <if test="collectInfo != null and collectInfo!=''">
                    and dc.collectInfo = #{collectInfo}
                </if>
                <if test="collectStatus != null and collectStatus!=''">
                    and dc.collect_status = #{collectStatus}
                </if>
                <if test="caseType != null and caseType!=''">
                    and da.case_type = #{caseType}
                </if>
                <if test="color != null and color!=''">
                    and da.color = #{color}
                </if>
                <if test="account != null and cardNo!=''">
                    and da.account = #{account}
                </if>
                <if test="archiveNo != null and archiveNo!=''">
                    and da.archive_no = #{archiveNo}
                </if>

                <if test="caseDateStart != null and caseDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')>=  DATE_FORMAT(#{caseDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="caseDateEnd != null and caseDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')<=  DATE_FORMAT(#{caseDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateStart != null and repayDateStart!=''">
                    <![CDATA[   and DATE_FORMATd(da.repay_date, '%Y-%m-%d')>=  DATE_FORMAT(#{repayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateEnd != null and repayDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.repay_date, '%Y-%m-%d')<=  DATE_FORMAT(#{repayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyStart != null and moneyStart!=''">
                    <![CDATA[   and da.money>=  #{moneyStart}  ]]>
                </if>
                <if test="moneyEnd != null and moneyEnd!=''" >
                    <![CDATA[   and da.money <=  #{moneyEnd}   ]]>
                </if>

                <if test="realReturnStartTime != null and realReturnStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')>=  DATE_FORMAT(#{realReturnStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="realReturnEndTime != null and realReturnEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')<=  DATE_FORMAT(#{realReturnEndTime}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
        order by ${orderBy} ${sort}
    </select>

    <select id="pageBatchBoundsCaseList" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select * from data_case where ident_no in (
        select da.ident_no
        from data_case da LEFT JOIN data_collection dc on da.id = dc.case_id
        <where>
            1 = 1
            <trim suffixOverrides=",">
                <if test="id != null and id!=''">
                    and da.id = #{id}
                </if>
                <if test="cardNo != null and cardNo!=''">
                    and da.card_no = #{cardNo}
                </if>
                <if test="clientFlag != null and clientFlag!=''">
                    and da.client in
                    <foreach item="item" index="index" collection="client" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="batchNo != null and batchNo!=''">
                    and da.batch_no = #{batchNo}
                </if>
                <if test="odv != null and odv!=''">
                    and da.odv = #{odv}
                </if>
                <if test="dept != null and dept!=''">
                    and da.dept = #{dept}
                </if>

                <if test="accountAge != null and accountAge!=''">
                    and da.account_age = #{accountAge}
                </if>
                <if test="seqNo != null and seqNo!=''">
                    and da.seq_no = #{seqNo}
                </if>
                <if test="collectArea != null and collectArea!=''">
                    and da.collect_area = #{collectArea}
                </if>
                <if test="overDays != null and overDays!=''">
                    and da.overDays = #{overDays}
                </if>
                <if test="area != null and area!=''">
                    and da.area = #{area}
                </if>
                <if test="license != null and license!=''">
                    and da.license = #{license}
                </if>
                <if test="expectStartTime != null and expectStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(da.expect_time, '%Y-%m-%d')>=  DATE_FORMAT(#{expectStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="expectEndTime != null and expectEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(da.expect_time, '%Y-%m-%d')<=  DATE_FORMAT(#{expectEndTime}, '%Y-%m-%d')   ]]>
                </if>

                <if test="collectHand != null and collectHand!=''">
                    and da.collect_hand = #{collectHand}
                </if>
                <if test="distributeStatus != null and distributeStatus!=''">
                    and da.distribute_status = #{distributeStatus}
                </if>
                <if test="identNo != null and identNo!=''">
                    and da.identNo = #{identNo}
                </if>
                <if test="vin != null and vin!=''">
                    and da.vin = #{vin}
                </if>
                <if test="name != null and name!=''">
                    and da.name = #{name}
                </if>
                <if test="status != null and status!=''">
                    and da.status = #{status}
                </if>
                <if test="bank != null and bank!=''">
                    and da.bank = #{bank}
                </if>
                <if test="collectStartDate != null and collectStartDate!=''">
                    <![CDATA[   and DATE_FORMAT(da.collect_date, '%Y-%m-%d')>=  DATE_FORMAT(#{collectStartDate}, '%Y-%m-%d')   ]]>
                </if>
                <if test="collectEndDate != null and collectEndDate!=''" >
                    <![CDATA[   and DATE_FORMAT(da.collect_date, '%Y-%m-%d')>=  DATE_FORMAT(#{collectEndDate}, '%Y-%m-%d')   ]]>
                </if>
                <if test="collectInfo != null and collectInfo!=''">
                    and dc.collectInfo = #{collectInfo}
                </if>
                <if test="collectStatus != null and collectStatus!=''">
                    and dc.collect_status = #{collectStatus}
                </if>
                <if test="caseType != null and caseType!=''">
                    and da.case_type = #{caseType}
                </if>
                <if test="color != null and color!=''">
                    and da.color = #{color}
                </if>
                <if test="account != null and cardNo!=''">
                    and da.account = #{account}
                </if>
                <if test="archiveNo != null and archiveNo!=''">
                    and da.archive_no = #{archiveNo}
                </if>

                <if test="caseDateStart != null and caseDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')>=  DATE_FORMAT(#{caseDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="caseDateEnd != null and caseDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')<=  DATE_FORMAT(#{caseDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateStart != null and repayDateStart!=''">
                    <![CDATA[   and DATE_FORMATd(da.repay_date, '%Y-%m-%d')>=  DATE_FORMAT(#{repayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateEnd != null and repayDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.repay_date, '%Y-%m-%d')<=  DATE_FORMAT(#{repayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyStart != null and moneyStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')>=  DATE_FORMAT(#{moneyStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyEnd != null and moneyEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')<=  DATE_FORMAT(#{moneyEnd}, '%Y-%m-%d')   ]]>
                </if>

                <if test="realReturnStartTime != null and realReturnStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')>=  DATE_FORMAT(#{realReturnStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="realReturnEndTime != null and realReturnEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')<=  DATE_FORMAT(#{realReturnEndTime}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
        order by ${orderBy} ${sort}
        )
    </select>


    <!--催收模块-我的案件-列表查询-->
    <select id="pageCaseInfo" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
        da.collect_status as collectStatus , da.account_age as accountAge ,da.seq_no as seqNo,da.case_date as caseDate,
        da.real_repay_date as realRepayDate ,da.name as name ,da.card_no as cardo,da.ident_no as identNo,
        da.money as money,da.balance as balance,da.over_days as overDays,da.pro_repay_date as proPepayDate,
        da.bank_amt as bankAmt,dc.collect_info as collectInfo
        from data_case da LEFT JOIN data_collection dc on da.id = dc.case_id
        <where>
            1 = 1
            <trim suffixOverrides=",">
                <if test="client != null and client!=''">
                    and da.client = #{client}
                </if>
                <if test="batchNo != null and batchNo!=''">
                    and da.batch_no = #{batchNo}
                </if>
                <if test="seqNo != null and seqNo!=''">
                    and da.seq_no = #{seqNo}
                </if>
                <if test="name != null and name!=''">
                    and da.name = #{name}
                </if>
                <if test="idenNo != null and idenNo!=''">
                    and da.iden_no = #{idenNo}
                </if>
                <if test="accountAge != null and accountAge!=''">
                    and da.account_age = #{accountAge}
                </if>
                <if test="account != null and account!=''">
                    and da.account = #{account}
                </if>
                <if test="status != null and status!=''">
                    and da.status = #{status}
                </if>
                <if test="collectStatus != null and collectStatus!=''">
                    and da.collect_status = #{collectStatus}
                </if>
                <if test="caseType != null and caseType!=''">
                    and da.case_type = #{caseType}
                </if>
                <if test="color != null and color!=''">
                    and da.color = #{color}
                </if>
                <if test="cardNo != null and cardNo!=''">
                    and da.card_no = #{cardNo}
                </if>
                <if test="archiveNo != null and archiveNo!=''">
                    and da.archive_no = #{archiveNo}
                </if>
                <if test="newCase != null and newCase!=''">
                    and da.new_case = #{newCase}
                </if>
                <if test="repayStatus != null and repayStatus!=''">
                    and da.repay_status = #{repayStatus}
                </if>
                <if test="reduceStatus != null and reduceStatus!=''">
                    and da.reduce_status = #{reduceStatus}
                </if>
                <if test="reportStatus != null and reportStatus!=''">
                    and da.report_status = #{reportStatus}
                </if>

                <if test="caseDateStart != null and caseDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')>=  DATE_FORMAT(#{caseDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="caseDateEnd != null and caseDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')<=  DATE_FORMAT(#{caseDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateStart != null and repayDateStart!=''">
                    <![CDATA[   and DATE_FORMATd(da.repay_date, '%Y-%m-%d')>=  DATE_FORMAT(#{repayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateEnd != null and repayDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.repay_date, '%Y-%m-%d')<=  DATE_FORMAT(#{repayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyStart != null and moneyStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')>=  DATE_FORMAT(#{moneyStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyEnd != null and moneyEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')<=  DATE_FORMAT(#{moneyEnd}, '%Y-%m-%d')   ]]>
                </if>

                <if test="realRepayDateStart != null and realRepayDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')>=  DATE_FORMAT(#{realRepayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="realRepayDateEnd != null and realRepayDateEnd!=''" >
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')<=  DATE_FORMAT(#{realRepayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
    </select>

    <!--统计金额-->
    <select id="sumCaseMoney" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
        id
        from data_case
        <where>
            <trim suffixOverrides=",">
                <if test="remark != null and remark!=''">
                    remark like CONCAT('%',#{remark},'%')
                </if>
            </trim>
        </where>
    </select>

    <update id="sendOdv" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set odv = #{odv},distribute_time=now()
        where id = #{id}
    </update>

    <update id="updateStatus" parameterType="java.lang.Integer">
        update data_case set status = #{status}
        where id = #{id}
    </update>

    <update id="addComment" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set comment = #{comment}
        where id = #{id}
    </update>


    <update id="updateComment" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set
        <trim suffixOverrides=",">
            <if test="comment != null">comment = #{comment},</if>
            <if test="color != null">color = #{color},</if>
        </trim>
        where seq_no = #{seqNo}
    </update>

    <update id="addColor" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set color = #{color}
        where id = #{id}
    </update>
    <update id="addImportant" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set important = #{important}
        where id = #{id}
    </update>
    <update id="addCollectStatus" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set collect_status = #{collectStatus}
        where id = #{id}
    </update>
    <update id="addCollectArea" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set collect_area = #{collectArea}
        where id = #{id}
    </update>
    <update id="addMValue" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set m_val = #{mVal}
        where id = #{id}
    </update>
    <update id="addSynergy" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set synergy = 2,synergy_date = now(),synergy_context =#{synergyContext}
        where id = #{id}
    </update>


    <!--数据模块-按照查询分配业务员-->
    <select id="sendOdvByProperty" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set odv = #{odv}
        where id  in (select da.id
        from data_case da LEFT JOIN data_collection dc on da.id = dc.case_id
        <where>
            1 = 1
            <trim suffixOverrides=",">
                <if test="client != null and client!=''">
                    and da.client = #{client}
                </if>
                <if test="batchNo != null and batchNo!=''">
                    and da.batch_no = #{batchNo}
                </if>
                <if test="odv != null and odv!=''">
                    and da.odv = #{odv}
                </if>
                <if test="dept != null and dept!=''">
                    and da.dept = #{dept}
                </if>

                <if test="accountAge != null and accountAge!=''">
                    and da.account_age = #{accountAge}
                </if>
                <if test="realReturnTime != null and realReturnTime!=''">
                    and da.real_return_time = #{realReturnTime}
                </if>
                <if test="seqNo != null and seqNo!=''">
                    and da.seq_no = #{seqNo}
                </if>
                <if test="collectArea != null and collectArea!=''">
                    and da.collect_area = #{collectArea}
                </if>
                <if test="overDays != null and overDays!=''">
                    and da.overDays = #{overDays}
                </if>
                <if test="area != null and area!=''">
                    and da.area = #{area}
                </if>
                <if test="license != null and license!=''">
                    and da.license = #{license}
                </if>
                <if test="expectTime != null and expectTime!=''">
                    and da.expect_time = #{expectTime}
                </if>
                <if test="collectHand != null and collectHand!=''">
                    and da.collect_hand = #{collectHand}
                </if>
                <if test="distributeStatus != null and distributeStatus!=''">
                    and da.distribute_status = #{distributeStatus}
                </if>
                <if test="identNo != null and identNo!=''">
                    and da.identNo = #{identNo}
                </if>
                <if test="vin != null and vin!=''">
                    and da.vin = #{vin}
                </if>
                <if test="name != null and name!=''">
                    and da.name = #{name}
                </if>
                <if test="idenNo != null and idenNo!=''">
                    and da.iden_no = #{idenNo}
                </if>
                <if test="accountAge != null and accountAge!=''">
                    and da.account_age = #{accountAge}
                </if>
                <if test="status != null and status!=''">
                    and da.status = #{status}
                </if>
                <if test="bank != null and bank!=''">
                    and da.bank = #{bank}
                </if>
                <if test="collectDate != null and collectDate!=''">
                    and da.collect_date = #{collectDate}
                </if>
                <if test="collectInfo != null and collectInfo!=''">
                    and dc.collectInfo = #{collectInfo}
                </if>
                <if test="collectStatus != null and collectStatus!=''">
                    and dc.collect_status = #{collectStatus}
                </if>
                <if test="caseType != null and caseType!=''">
                    and da.case_type = #{caseType}
                </if>
                <if test="color != null and color!=''">
                    and da.color = #{color}
                </if>
                <if test="cardNo != null and cardNo!=''">
                    and da.card_no = #{cardNo}
                </if>
                <if test="archiveNo != null and archiveNo!=''">
                    and da.archive_no = #{archiveNo}
                </if>
                <if test="newCase != null and newCase!=''">
                    and da.new_case = #{newCase}
                </if>
                <if test="repayStatus != null and repayStatus!=''">
                    and da.repay_status = #{repayStatus}
                </if>

                <if test="caseDateStart != null and caseDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')>=  DATE_FORMAT(#{caseDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="caseDateEnd != null and caseDateEnd!=''">
                    <![CDATA[   and DATE_FORMAT(da.case_date, '%Y-%m-%d')<=  DATE_FORMAT(#{caseDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateStart != null and repayDateStart!=''">
                    <![CDATA[   and DATE_FORMATd(da.repay_date, '%Y-%m-%d')>=  DATE_FORMAT(#{repayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="repayDateEnd != null and repayDateEnd!=''">
                    <![CDATA[   and DATE_FORMAT(da.repay_date, '%Y-%m-%d')<=  DATE_FORMAT(#{repayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyStart != null and moneyStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')>=  DATE_FORMAT(#{moneyStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="moneyEnd != null and moneyEnd!=''">
                    <![CDATA[   and DATE_FORMAT(da.money, '%Y-%m-%d')<=  DATE_FORMAT(#{moneyEnd}, '%Y-%m-%d')   ]]>
                </if>

                <if test="realRepayDateStart != null and realRepayDateStart!=''">
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')>=  DATE_FORMAT(#{realRepayDateStart}, '%Y-%m-%d')   ]]>
                </if>
                <if test="realRepayDateEnd != null and realRepayDateEnd!=''">
                    <![CDATA[   and DATE_FORMAT(da.real_return_time, '%Y-%m-%d')<=  DATE_FORMAT(#{realRepayDateEnd}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
        )
    </select>



    <!--催收模块-主管协催-列表查询-->
    <select id="pageSynergyInfo" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
         id, synergy_context as synergyContext,seq_no as seqNo,odv,DATE_FORMAT(synergy_date,'%Y-%m-%d %H:%i:%S') as synergyDate
        from data_case
        <where>
            synergy = #{synergy}
            <trim suffixOverrides=",">
                <if test="dept != null and dept!=''">
                    and dept = #{dept}
                </if>
                <if test="odv != null and odv!=''">
                    and odv = #{odv}
                </if>
                <if test="client != null and client!=''">
                    and client = #{client}
                </if>
                <if test="synergyStartTime != null and synergyStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(synergy_date, '%Y-%m-%d')>=  DATE_FORMAT(#{synergyStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="synergyEndTime != null and synergyEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(synergy_date, '%Y-%m-%d')<=  DATE_FORMAT(#{synergyEndTime}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
    </select>

    <select id="countSynergyInfo" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="java.lang.Integer">
        select
        count(id) as num
        from data_case
        <where>
            synergy = #{synergy}
            <trim suffixOverrides=",">
                <if test="dept != null and dept!=''">
                    and dept = #{dept}
                </if>
                <if test="odv != null and odv!=''">
                    and odv = #{odv}
                </if>
                <if test="client != null and client!=''">
                    and client = #{client}
                </if>
                <if test="synergyStartTime != null and synergyStartTime!=''">
                    <![CDATA[   and DATE_FORMAT(synergy_date, '%Y-%m-%d')>=  DATE_FORMAT(#{synergyStartTime}, '%Y-%m-%d')   ]]>
                </if>
                <if test="synergyEndTime != null and synergyEndTime!=''" >
                    <![CDATA[   and DATE_FORMAT(synergy_date, '%Y-%m-%d')<=  DATE_FORMAT(#{synergyEndTime}, '%Y-%m-%d')   ]]>
                </if>
            </trim>
        </where>
    </select>

    <update id="updateSynergy" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case set synergy = #{synergy}
        where id = #{id}
    </update>



    <select id="pageCaseTel" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
        t.id,t.seq_no as seqNo,t.name,t.card_no as cardNo,t.money,t.case_date as caseDate,t.collect_status as collectStatus,t.collect_date as collectDate,
        t.pro_repay_amt as proRepayAmt,t.en_repay_amt as enRepayAmt,t.account_age as accountAge,t.odv
        from data_case t LEFT JOIN data_case_tel l on t.id = l.case_id
                      LEFT  JOIN data_case_address d on t.id = d.case_id
        <where>
            <trim suffixOverrides=",">
                <if test="clientFlag != null and clientFlag!='' and queryMethod=='1'.toString()" >
                    and t.client in
                    <foreach item="item" index="index" collection="clients" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="name != null and name!='' and queryMethod=='1'.toString()">
                    and t.name = #{name}
                </if>
                <if test="cardNo != null and cardNo!='' and queryMethod=='1'.toString()">
                    and t.card_no = #{cardNo}
                </if>
                <if test="unitName != null and unitName!='' and queryMethod=='1'.toString()">
                    and t.unit_name = #{unitName}
                </if>
                <if test="identNo != null and identNo!='' and queryMethod=='1'.toString()">
                    and t.ident_no = #{identNo}
                </if>
                <if test="address != null and address!='' and queryMethod=='1'.toString()">
                    and d.address = #{address}
                </if>
                <if test="tel != null and tel!='' and queryMethod=='1'.toString()">
                    and l.tel = #{tel}
                </if>
                <if test="clientFlag != null and clientFlag!='' and queryMethod=='2'.toString()" >
                    and t.client in
                    <foreach item="item" index="index" collection="clients" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                <if test="name != null and name!='' and queryMethod=='2'.toString()">
                    AND t.name like CONCAT('%',#{name},'%')
                </if>
                <if test="cardNo != null and cardNo!='' and queryMethod=='2'.toString()">
                    AND t.card_no like CONCAT('%',#{cardNo},'%')
                </if>
                <if test="unitName != null and unitName!='' and queryMethod=='2'.toString()">
                    AND t.unit_name like CONCAT('%',#{unitName},'%')
                </if>
                <if test="identNo != null and identNo!='' and queryMethod=='2'.toString()">
                    AND t.ident_no like CONCAT('%',#{identNo},'%')
                </if>
                <if test="address != null and address!='' and queryMethod=='2'.toString()">
                    AND d.address like CONCAT('%',#{address},'%')
                </if>
                <if test="tel != null and tel!='' and queryMethod=='2'.toString()">
                    AND l.tel like CONCAT('%',#{tel},'%')
                </if>
            </trim>
        </where>
        order by ${orderBy} ${sort}
    </select>

    <select id="countCaseTel" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="java.lang.Integer">
        select
        count(id) as sum
        from data_case t LEFT JOIN data_case_tel l on t.id = l.case_id
        LEFT  JOIN data_case_address d on t.id = d.case_id
        <where>
            <trim suffixOverrides=",">
                <if test="client != null and client!='' and queryMethod='1'">
                    and t.client = #{client}
                </if>
                <if test="name != null and name!='' and queryMethod='1'">
                    and t.name = #{name}
                </if>
                <if test="cardNo != null and cardNo!='' and queryMethod='1'">
                    and t.card_no = #{cardNo}
                </if>
                <if test="unitName != null and unitName!='' and queryMethod='1'">
                    and t.unit_name = #{unitName}
                </if>
                <if test="identNo != null and identNo!='' and queryMethod='1'">
                    and t.ident_no = #{identNo}
                </if>
                <if test="address != null and address!='' and queryMethod='1'">
                    and d.address = #{address}
                </if>
                <if test="tel != null and tel!='' and queryMethod='1'">
                    and l.address = #{tel}
                </if>

                <if test="client != null and client!='' and queryMethod='2'">
                    AND t.client like CONCAT('%',#{client},'%')
                </if>
                <if test="name != null and name!='' and queryMethod='2'">
                    AND t.name like CONCAT('%',#{name},'%')
                </if>
                <if test="cardNo != null and cardNo!='' and queryMethod='2'">
                    AND t.card_no like CONCAT('%',#{cardNo},'%')
                </if>
                <if test="unitName != null and unitName!='' and queryMethod='2'">
                    AND t.unit_name like CONCAT('%',#{unitName},'%')
                </if>
                <if test="identNo != null and identNo!='' and queryMethod='2'">
                    AND t.ident_no like CONCAT('%',#{identNo},'%')
                </if>
                <if test="address != null and address!='' and queryMethod='2'">
                    AND d.address like CONCAT('%',#{address},'%')
                </if>
                <if test="tel != null and tel!='' and queryMethod='2'">
                    AND l.tel like CONCAT('%',#{tel},'%')
                </if>
            </trim>
        </where>
    </select>



    <select id="listAllCaseInfo" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
        da.collect_status as collectStatus , da.account_age as accountAge ,da.seq_no as seqNo,da.case_date as caseDate,
        da.real_repay_date as realRepayDate ,da.name as name ,da.card_no as cardo,da.ident_no as identNo,
        da.money as money,da.balance as balance,da.over_days as overDays,da.pro_repay_date as proPepayDate,
        da.bank_amt as bankAmt
        from data_case da
        where delete_flag = 0
    </select>

    <select id="listBySeqNoSet" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity" resultType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        select
            id as id,
            seq_no as seqNo
        from data_case
        where delete_flag = 0
        and seq_no in
              <foreach collection="seqNoSet" open="(" close=")" separator="," item="item">
                  #{item}
              </foreach>
    </select>

    <update id="updateBySeqNo" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        update data_case
        set
            case_date = #{caseDate},
            money = #{money},
            case_deadline = #{caseDeadline},
            collect_hand = #{collectHand},
            rmb = #{rmb},
            hkd = #{hkd},
            foreign_currency = #{foreignCurrency},
            gender = #{gender},
            name = #{name},
            card_no = #{cardNo},
            ident_no = #{identNo},
            ident_type = #{identType},
            <if test="collectionUser != null and collectionUser.id != null">
                collection_user = #{collectionUser.id},
            </if>
            <if test="collectionArea != null and collectionArea.id != null">
                collection_area = #{collectionArea.id},
            </if>
            summary = #{collectInfo},
            m_val = #{mVal},
            commission_rate = #{commissionRate},
            commission_money = #{commissionMoney},
            home_tel_number = #{homeTelNumber},
            unti_tel_number = #{unitTelNumber},
            tel = #{tel},
            unit_name = #{unitName},
            case_user_position = #{caseUserPosition},
            case_user_depart = #{caseUserDepart},
            unit_address = #{unitAddress},
            unit_zip_code = #{unitZipCode},
            home_address = #{homeAddress},
            home_zip_code = #{homeZipCode},
            statement_address = #{statementAddress},
            statement_zip_code = #{statementZipCode},
            census_register_address = #{censusRegisterAddress},
            census_register_zip_code = #{censusRegisterZipCode},
            qq = #{qq},
            email = #{email},
            birthday = #{birthday},
            age = #{age},
            <if test="province != null and province.id != null">
                province = #{province.id},
            </if>
            <if test="city != null and city.id != null">
                city = #{city.id},
            </if>
            <if test="county != null and county.id != null">
                county = #{county.id},
            </if>
            expect_retire_case_date = #{expectRetireCaseDate},
            goods = #{goods},
            commercial_tenant = #{commercialTenant},
            archive_no = #{archiveNo},
            apply_order_no = #{applyOrderNo},
            social_security_computer_no = #{socialSecurityComputerNo},
            social_security_card_no = #{socialSecurityCardNo},
            bank = #{bank},
            account_no = #{accountNo},
            account_name = #{accountName},
            card_type = #{cardType},
            principle = #{principle},
            loan_rate = #{loanRate},
            residual_principle = #{residualPrinciple},
            monthly_repayments = #{monthlyRepayments},
            minimum_payment = #{minimumPayment},
            credit_line = #{creditLine},
            fixed_quota = #{fixedQuota},
            default_level = #{defaultLevel},
            last_repay_money = #{lastRepayMoney},
            last_repay_date = #{lastRepayDate},
            last_consume_date = #{lastConsumeDate},
            last_withdraw_date = #{lastWithdrawDate},
            stop_card_date = #{stopCardDate},
            active_card_date = #{activeCardDate},
            bill_date = #{billDate},
            bill_cycle = #{billCycle},
            outstanding_amount = #{outstandingAmount},
            main_deputy_card = #{mainDeputyCard},
            deputy_card_user_name = #{deputyCardUserName},
            loan_date = #{loanDate},
            loan_deadline = #{loanDeadline},
            overdue_date = #{overdueDate},
            overdue_periods = #{overduePeriods},
            overdue_days = #{overdueDays},
            overdue_times = #{overdueTimes},
            entrust_periods = #{entrustPeriods},
            repay_deadline = #{repayDeadline},
            repaid_periods = #{repaidPeriods},
            loan_type = #{loanType},
            collection_type = #{collectionType},
            overdue_money = #{overdueMoney},
            overdue_principle = #{overduePrinciple},
            overdue_interest = #{overdueInterest},
            overdue_management_cost = #{overdueManagementCost},
            overdue_default_interest = #{overdueDefaultInterest},
            penalty = #{penalty},
            late_fee = #{lateFee},
            overrun_fee = #{overrunFee},
            bail = #{bail},
            currency_type = #{currencyType},
            last_collection_record = #{lastCollectionRecord},
            overdue_bill_time = #{overdueBillTime},
            contract_no = #{contractNo},
            over_days = #{overDays},
            dealer = #{dealer},
            apply_date = #{applyDate},
            repay_date = #{repayDate},
            policy_expiry_date = #{policyExpiryDate},
            card_price = #{cardPrice},
            card_model = #{cardModel},
            license = #{license},
            brand = #{brand},
            vin = #{vin},
            engine_no = #{engineNo}
            where seq_no = #{seqNo}
    </update>

    <insert id="saveCase" parameterType="xyz.zaijushou.zhx.sys.entity.DataCaseEntity">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into data_case
        (
        seq_no,
        case_date,
        money,
        case_deadline,
        collect_hand,
        rmb,
        hkd,
        foreign_currency,
        gender,
        name,
        card_no,
        ident_no,
        ident_type,
        <if test="collectionUser != null and collectionUser.id != null">
            collection_user,
        </if>
        <if test="collectionArea != null and collectionArea.id != null">
            collection_area,
        </if>
        summary,
        m_val,
        commission_rate,
        commission_money,
        home_tel_number,
        unti_tel_number,
        tel,
        unit_name,
        case_user_position,
        case_user_depart,
        unit_address,
        unit_zip_code,
        home_address,
        home_zip_code,
        statement_address,
        statement_zip_code,
        census_register_address,
        census_register_zip_code,
        qq,
        email,
        birthday,
        age,
        <if test="province != null and province.id != null">
            province,
        </if>
        <if test="city != null and city.id != null">
            city,
        </if>
        <if test="county != null and county.id != null">
            county,
        </if>
        expect_retire_case_date,
        goods,
        commercial_tenant,
        archive_no,
        apply_order_no,
        social_security_computer_no,
        social_security_card_no,
        bank,
        account_no,
        account_name,
        card_type,
        principle,
        loan_rate,
        residual_principle,
        monthly_repayments,
        minimum_payment,
        credit_line,
        fixed_quota,
        default_level,
        last_repay_money,
        last_repay_date,
        last_consume_date,
        last_withdraw_date,
        stop_card_date,
        active_card_date,
        bill_date,
        bill_cycle,
        outstanding_amount,
        main_deputy_card,
        deputy_card_user_name,
        loan_date,
        loan_deadline,
        overdue_date,
        overdue_periods,
        overdue_days,
        overdue_times,
        entrust_periods,
        repay_deadline,
        repaid_periods,
        loan_type,
        collection_type,
        overdue_money,
        overdue_principle,
        overdue_interest,
        overdue_management_cost,
        overdue_default_interest,
        penalty,
        late_fee,
        overrun_fee,
        bail,
        currency_type,
        last_collection_record,
        overdue_bill_time,
        contract_no,
        over_days,
        dealer,
        apply_date,
        repay_date,
        policy_expiry_date,
        card_price,
        card_model,
        license,
        brand,
        vin,
        engine_no,

        batch_no
        )
        values
        (
        #{seqNo},
        #{caseDate},
        #{money},
        #{caseDeadline},
        #{collectHand},
        #{rmb},
        #{hkd},
        #{foreignCurrency},
        #{gender},
        #{name},
        #{cardNo},
        #{identNo},
        #{identType},
        <if test="collectionUser != null and collectionUser.id != null">
            #{collectionUser.id},
        </if>
        <if test="collectionArea != null and collectionArea.id != null">
            #{collectionArea.id},
        </if>
        #{collectInfo},
        #{mVal},
        #{commissionRate},
        #{commissionMoney},
        #{homeTelNumber},
        #{unitTelNumber},
        #{tel},
        #{unitName},
        #{caseUserPosition},
        #{caseUserDepart},
        #{unitAddress},
        #{unitZipCode},
        #{homeAddress},
        #{homeZipCode},
        #{statementAddress},
        #{statementZipCode},
        #{censusRegisterAddress},
        #{censusRegisterZipCode},
        #{qq},
        #{email},
        #{birthday},
        #{age},
        <if test="province != null and province.id != null">
            #{province.id},
        </if>
        <if test="city != null and city.id != null">
            #{city.id},
        </if>
        <if test="county != null and county.id != null">
            #{county.id},
        </if>
        #{expectRetireCaseDate},
        #{goods},
        #{commercialTenant},
        #{archiveNo},
        #{applyOrderNo},
        #{socialSecurityComputerNo},
        #{socialSecurityCardNo},
        #{bank},
        #{accountNo},
        #{accountName},
        #{cardType},
        #{principle},
        #{loanRate},
        #{residualPrinciple},
        #{monthlyRepayments},
        #{minimumPayment},
        #{creditLine},
        #{fixedQuota},
        #{defaultLevel},
        #{lastRepayMoney},
        #{lastRepayDate},
        #{lastConsumeDate},
        #{lastWithdrawDate},
        #{stopCardDate},
        #{activeCardDate},
        #{billDate},
        #{billCycle},
        #{outstandingAmount},
        #{mainDeputyCard},
        #{deputyCardUserName},
        #{loanDate},
        #{loanDeadline},
        #{overdueDate},
        #{overduePeriods},
        #{overdueDays},
        #{overdueTimes},
        #{entrustPeriods},
        #{repayDeadline},
        #{repaidPeriods},
        #{loanType},
        #{collectionType},
        #{overdueMoney},
        #{overduePrinciple},
        #{overdueInterest},
        #{overdueManagementCost},
        #{overdueDefaultInterest},
        #{penalty},
        #{lateFee},
        #{overrunFee},
        #{bail},
        #{currencyType},
        #{lastCollectionRecord},
        #{overdueBillTime},
        #{contractNo},
        #{overDays},
        #{dealer},
        #{applyDate},
        #{repayDate},
        #{policyExpiryDate},
        #{cardPrice},
        #{cardModel},
        #{license},
        #{brand},
        #{vin},
        #{engineNo},
        #{batchNo}
        )
    </insert>
</mapper>